!function(){var MAP={};MAP.TEMP_BOTTOMBAR='<div class="bottombar">        <a href="javascript:void(0);" class="btn_like_gray" id="upvote">\x3c!-- 点击后用 btn_like_red --\x3e            <span class="icon_heart"></span>            <strong>赞</strong>            <span class="likenum">0</span>            <b class="onetxt"></b>        </a>        <div class="btn_favbar" data-favorite-content="2">            <a data-favorite-article-btn="2" href="javascript:void(0);" class="btn_fav" > \x3c!-- 收藏后，文案为 已收藏 ，样式名加上 btn_have_fav --\x3e                <span class="icon_star"></span>                <strong>收藏</strong>                <b class="onetxt"></b>            </a>            <div data-favorite-article="success" class="fav_tip fav_tip_succ" >收藏成功 <a  data-check-my-favorite-btn="2" target="_blank" href="//h5.mini.wps.cn/wps/vrelease/#/account/favorite?from=bottombar">查看我的收藏&gt;&gt;</a></div>            <div data-favorite-article="fail" class="fav_tip fav_tip_fail" style="display: none;" >收藏失败</div>        </div>    </div>';var MiniApi=function(){var jsAsynCall=function(data){if(!0===data.callback){var defer=$.Deferred(),_callback=data.callback="minisite_asyn_cb_"+Math.floor(1e3*Math.random());window[_callback]=function(response){var result={};try{result=$.parseJSON(response)}catch(_e){try{result=eval("("+response+")")}catch(e){result={result:response,exception:"JSON PARSE ERROR"}}}"ok"===result.status?defer.resolve(result):defer.reject(result),delete window[_callback]},MiniApi.check()||setTimeout(function(){defer.resolve({isweb:!0})})}return WPS_NPP.COMON.callMiniApi(data),defer};return{check:function(){return WPS_NPP.COMON.onClient},JsEnCodeString:function(e){return jsAsynCall({method:"JsEnCodeString",str:e,callback:!0})},JsDeCodeString:function(e){return jsAsynCall({method:"JsDeCodeString",str:e,callback:!0})},jsGet:function(e,t,a,n){var s={method:"JsRequest",url:e,param:t,timeout:a};if(n){var i="miniget_"+Math.ceil(1e6*Math.random());window[i]=n,s.callback=i}jsAsynCall(s)},jsPost:function(e,t,a,n,s,i){var o={method:"JsPost",url:e,param:t,header:s,body:i,timeout:a};if(n){var c="minipost_"+Math.ceil(1e6*Math.random());window[c]=n,o.callback=c}jsAsynCall(o)},getAppInfo:function(e,t){return jsAsynCall({method:"CallExApi",func:e,param:void 0===t?"":t,callback:!0})},getAccountInfo:function(){return jsAsynCall({method:"GetAccountInfo",callback:!0})},Login:function(e){return jsAsynCall({method:"Login",callback:!0,param:e})}}}(),MAIN_LOGIC=function(){var jqcontainer=$(document),jqInjectArea=$("#wps_minisite_bottombar");WPS_NPP.COMON.loadCss(jqInjectArea.next("script").attr("src").replace(".js",".css")),WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","show"),jqInjectArea.append(MAP.TEMP_BOTTOMBAR);var CATESNAME=$(".newstag span").text()||"";!function(){var e=!1,t=!1;$("#upvote").click(function(){t||(t=!0,e?$.ajax({type:"get",cache:!1,url:"//feed.mini.wps.cn/feed/v1/news/cancellike",dataType:"jsonp",data:{hdid:WPS_NPP.DATACOLLECT.getUID(),distsrc:WPS_NPP.FINAL_CONST.DISNUM,version:WPS_NPP.FINAL_CONST.CLIENT_VER,rt:WPS_NPP.FINAL_CONST.RT,newsid:WPS_NPP.FINAL_CONST.NEWSID},success:function(a){if(t=!1,"ok"===a.result){e=!1;var n=$("#upvote .onetxt");$("#upvote").removeClass("btn_like_red"),$("#upvote .likenum").show().text(parseInt($("#upvote .likenum").text())-1),0==parseInt($("#upvote .likenum").text())?($("#upvote strong").text("赞"),$("#upvote .likenum").hide()):$("#upvote strong").text("赞"),n.text("-1"),n.removeClass("addtxt"),"absolute"==n.css("position")?n.show().addClass("minustxt"):n.hide().removeClass("addtxt").removeClass("minustxt")}}}):($.ajax({type:"get",cache:!1,url:"//feed.mini.wps.cn/feed/v1/news/dislike",dataType:"jsonp",data:{hdid:WPS_NPP.DATACOLLECT.getUID(),distsrc:WPS_NPP.FINAL_CONST.DISNUM,version:WPS_NPP.FINAL_CONST.CLIENT_VER,rt:WPS_NPP.FINAL_CONST.RT,newsid:WPS_NPP.FINAL_CONST.NEWSID,like:e?0:1},success:function(a){if(t=!1,"ok"===a.result){e=!0;var n=$("#upvote .onetxt");$("#upvote").addClass("btn_like_red"),$("#upvote strong").text("已赞"),$("#upvote .likenum").show().text(parseInt($("#upvote .likenum").text())+1),n.text("+1"),n.removeClass("minustxt"),"absolute"==n.css("position")?n.show().addClass("addtxt"):n.hide().removeClass("addtxt").removeClass("minustxt")}}}),creditSystem&&creditSystem.likeArticle())),WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","click_like",e?"detail_like":"detail_unlike",WPS_NPP.FINAL_CONST.NEWSID)}),$.ajax({type:"get",cache:!1,url:"//feed.mini.wps.cn/feed/v1/news/likecount",dataType:"jsonp",data:{hdid:WPS_NPP.DATACOLLECT.getUID(),newsid:WPS_NPP.FINAL_CONST.NEWSID},success:function(t){"ok"===t.result&&(e=t.data.liked,t.data.liked?($("#upvote strong").text("已赞"),$("#upvote .likenum").show().text(t.data.count),$("#upvote").addClass("btn_like_red")):t.data.count>0&&($("#upvote strong").text("赞"),$("#upvote .likenum").show().text(t.data.count)))}})}(),function(){function hoverIn(){1===saveResult?save_success.show():2===saveResult&&save_fail.show()}function hoverOut(){save_success.hide(),save_fail.hide()}function checkArticle(e){$.ajax({type:"get",cache:!1,url:"//feed.mini.wps.cn/feed/v1/collection/check",dataType:"jsonp",data:{sid:userInfo.wpssid,newsid:WPS_NPP.FINAL_CONST.NEWSID},success:function(t){"ok"===t.result&&t.data.collected&&(save_favorite_btn1.addClass("btn_have_fav"),save_favorite_btn2.addClass("btn_have_fav"),save_favorite_btn1.children("strong").text("已收藏"),save_favorite_btn2.children("strong").text("已收藏"),isSaveed=!0,saveResult=1),e()}})}function getAccountInfo(){var e=$.Deferred();return MiniApi.getAccountInfo().then(function(t){userInfo=t.info,t.isweb?userInfo={account:"xiaoming@wps.cn",wpssid:"V02S64f3OOmG5gpP-vnYRCpMNlSsR2400af9d844001347972e"}:(checkArticle(function(){e.resolve(!1)}),needLogin=!1)},function(t){if(t&&"fail to invoke method"===t.errormsg)return save_favorite_btn1.hide(),void save_favorite_btn2.hide();needLogin=!0,e.resolve(!0)}),e}function checkLoginStatus(){getAccountInfo().then(function(){needLogin?MiniApi.Login("detail").then(function(e){needLogin=!1}):clickSaveFavorite()})}function clickSaveFavorite(){function e(e){"ok"===JSON.parse(e).status?(save_favorite_btn1.addClass("btn_have_fav"),save_favorite_btn2.addClass("btn_have_fav"),save_favorite_btn1.children("strong").text("已收藏"),save_favorite_btn2.children("strong").text("已收藏"),save_success.show(),save_fail.hide(),isSaveed=!0,saveResult=1,creditSystem&&creditSystem.saveFavorite()):(save_success.hide(),save_fail.show(),isSaveed=!1,saveResult=2)}if(needLogin)checkLoginStatus();else if(!isSaveed){var t={newsid:WPS_NPP.FINAL_CONST.NEWSID,hdid:WPS_NPP.FINAL_CONST.HDID,sid:userInfo.wpssid};MiniApi.JsEnCodeString("hdid="+t.hdid+"newsid="+t.newsid+"sid="+userInfo.wpssid).then(function(a){MiniApi.getAppInfo("md5string",a.encoded).then(function(a){t.sig=a.result;var n=location.protocol+"//feed.mini.wps.cn/feed/v1/collection/add",s="Content-Type:application/x-www-form-urlencoded;charset=UTF-8\r\nsid:"+userInfo.wpssid+"\r\n";MiniApi.jsPost(n,"","3000",e,s,$.param(t))})})}}function clickSaveFavoriteBtn1(){WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","click_favorite_button",1,CATESNAME.trim()),clickSaveFavorite()}function clickSaveFavoriteBtn2(){WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","click_favorite_button",2,CATESNAME.trim()),clickSaveFavorite()}function checkMyFavorite1(){WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","check_my_favorite",1,CATESNAME.trim())}function checkMyFavorite2(){WPS_NPP.DATACOLLECT.sendCollect("buttombar_sdk","check_my_favorite",2,CATESNAME.trim())}var save_success=$('div[data-favorite-article="success"]'),save_fail=$('div[data-favorite-article="fail"]'),save_favorite_btn1=$('a[data-favorite-article-btn="1"]'),save_favorite_btn2=$('a[data-favorite-article-btn="2"]'),check_my_favorite_btn1=$('a[data-check-my-favorite-btn="1"]'),check_my_favorite_btn2=$('a[data-check-my-favorite-btn="2"]'),favorite_content1=$('div[data-favorite-content="1"]'),favorite_content2=$('div[data-favorite-content="2"]');WPS_NPP.COMON.onClient||favorite_content2.hide();var isSaveed=!1,needLogin=!1,saveResult=0,userInfo={};save_favorite_btn1.on("click",clickSaveFavoriteBtn1),save_favorite_btn2.on("click",clickSaveFavoriteBtn2),check_my_favorite_btn1.on("click",checkMyFavorite1),check_my_favorite_btn2.on("click",checkMyFavorite2),favorite_content1.hover(hoverIn,hoverOut),favorite_content2.hover(hoverIn,hoverOut),getAccountInfo(),window.wpsLogin=function(res){console.log("wpsLogin"),isSaveed=!1,needLogin=!1,saveResult=0;var result={info:{pic:""}};try{result=$.parseJSON(res)}catch(_e){try{result=eval("("+res+")")}catch(e){result={result:res,exception:"JSON PARSE ERROR"}}}userInfo=result.info,creditSystem&&creditSystem.creditTranfer(),checkArticle(function(){})},window.wpsLogout=function(e){isSaveed=!1,needLogin=!0,saveResult=0,userInfo={},save_favorite_btn1.removeClass("btn_have_fav"),save_favorite_btn2.removeClass("btn_have_fav"),save_favorite_btn1.children("strong").text("收藏"),save_favorite_btn2.children("strong").text("收藏")}}()};MAIN_LOGIC(),console.log("【装载】尾部按钮")}();